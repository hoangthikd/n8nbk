{"createdAt":"2025-04-11T22:50:18.733Z","updatedAt":"2025-04-11T22:50:18.733Z","id":"Hhqrb4QeDJFHDbQC","name":"Report","active":false,"nodes":[{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-160,-200],"id":"75a770c7-64ec-42bf-bc99-6ff33df45dd9","name":"When chat message received","webhookId":"366f1070-0490-45db-9fac-89c4e41b5aca"},{"parameters":{"documentId":{"__rl":true,"value":"1da8FbD_Bw9Gb3CPbwUQ6r3zADv2w60sWM4TElwGJuhk","mode":"list","cachedResultName":"Schema Table BigQuery","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1da8FbD_Bw9Gb3CPbwUQ6r3zADv2w60sWM4TElwGJuhk/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"schema","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1da8FbD_Bw9Gb3CPbwUQ6r3zADv2w60sWM4TElwGJuhk/edit#gid=0"},"options":{}},"type":"n8n-nodes-base.googleSheetsTool","typeVersion":4.5,"position":[280,40],"id":"5fe2abd4-02f3-488c-bcaa-bcf3e437e45c","name":"table-info","credentials":{"googleSheetsOAuth2Api":{"id":"WgF6l0tsz1Jeq8pk","name":"Google Sheets account"}}},{"parameters":{"contextWindowLength":20},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[140,40],"id":"0e306b2d-4be6-4a18-9377-a7fe16bb19e6","name":"Simple Memory"},{"parameters":{"projectId":{"__rl":true,"mode":"id","value":"n8n-tutorial-452114"},"sqlQuery":"{{ $fromAI('sqlquery') }}","options":{}},"type":"n8n-nodes-base.googleBigQueryTool","typeVersion":2.1,"position":[400,40],"id":"6d68d996-e750-4285-9b0f-70029562dec1","name":"Big Query","credentials":{"googleBigQueryOAuth2Api":{"id":"m6cuKhEidHJucQSW","name":"Google BigQuery account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[0,40],"id":"69cd29ba-414e-44b8-83b7-778c10349cd8","name":"4o-mini","credentials":{"openAiApi":{"id":"YUXfwQd3CGq9bfen","name":"OpenAi account"}}},{"parameters":{"options":{"systemMessage":"=# **Overview**:\nB·∫°n l√† m·ªôt chuy√™n gia ph√¢n t√≠ch d·ªØ li·ªáu v√† SQL chuy√™n nghi·ªáp.  \nNhi·ªám v·ª• c·ªßa b·∫°n l√† ki·ªÉm tra schema c·ªßa b·∫£ng d·ªØ li·ªáu (l·∫•y t·ª´ c√¥ng c·ª• `table-info`) v√† vi·∫øt c√°c truy v·∫•n SQL ph√π h·ª£p ƒë·ªÉ tr√≠ch xu·∫•t th√¥ng tin c·∫ßn thi·∫øt cho b√°o c√°o kinh doanh theo th√°ng (nh·∫≠n t·ª´ chatinput c·ªßa ng∆∞·ªùi d√πng)\n\n# **Y√™u c·∫ßu c√¥ng vi·ªác:**\n1. **Ph√¢n t√≠ch schema c·ªßa b·∫£ng d·ªØ li·ªáu ƒë·∫ßu v√†o**, ƒë·∫£m b·∫£o l·∫•y ƒë√∫ng ƒë∆∞·ª£c table_id ƒë·ªÉ ƒë∆∞a v√†o ph·∫ßn FROM trong SQL. Hi·ªÉu ƒë√∫ng ng·ªØ c·∫£nh c√°c c·ªôt, ki·ªÉu d·ªØ li·ªáu v√† m·ªëi quan h·ªá gi·ªØa ch√∫ng.\n2. **Vi·∫øt truy v·∫•n SQL** ƒë·ªÉ l·∫•y d·ªØ li·ªáu c·∫ßn thi·∫øt cho m·∫´u b√°o c√°o d∆∞·ªõi ƒë√¢y:\n    B√ÅO C√ÅO K·∫æT QU·∫¢ KINH DOANH TH√ÅNG [....]\n    \n    ## 1Ô∏è‚É£ T·ªïng quan doanh thu & l·ª£i nhu·∫≠n\n    - **T·ªïng doanh thu**: 97,219.37  \n    - **T·ªïng chi ph√≠ h√†ng h√≥a (COGS)**: 92,589.88  \n    - **T·ªïng l·ª£i nhu·∫≠n g·ªôp**: 4,629.49  \n    - **T·ª∑ su·∫•t l·ª£i nhu·∫≠n g·ªôp trung b√¨nh**: 4.76%\n    \n    ## 2Ô∏è‚É£ Hi·ªáu su·∫•t b√°n h√†ng theo danh m·ª•c s·∫£n ph·∫©m\n    | Danh m·ª•c                 | Doanh thu  | S·ªë l∆∞·ª£ng b√°n | L·ª£i nhu·∫≠n g·ªôp |\n    |--------------------------|------------|--------------|---------------|\n    | Fashion accessories      | 19,009.86  | 295          | 905.23        |\n    | Sports and travel        | 13,809.61  | 226          | 657.60        |\n    | Electronic accessories   | 17,362.91  | 313          | 826.81        |\n    | Food and beverages       | 20,000.36  | 349          | 952.40        |\n    | Health and beauty        | 14,602.26  | 266          | 695.35        |\n    | Home and lifestyle       | 12,434.38  | 205          | 592.11        |\n    \n    ## 3Ô∏è‚É£ Hi·ªáu su·∫•t chi nh√°nh & khu v·ª±c\n    | Chi nh√°nh | Th√†nh ph·ªë  | Doanh thu  | S·ªë h√≥a ƒë∆°n | L·ª£i nhu·∫≠n g·ªôp |\n    |-----------|------------|------------|------------|---------------|\n    | B         | Mandalay   | 34,424.27  | 109        | 1,639.25      |\n    | C         | Naypyitaw  | 32,934.98  | 100        | 1,568.33      |\n    | A         | Yangon     | 29,860.12  | 94         | 1,421.91      |\n    \n    ## 4Ô∏è‚É£ H√†nh vi kh√°ch h√†ng\n    | Lo·∫°i kh√°ch h√†ng | T·ªïng doanh thu | S·ªë h√≥a ƒë∆°n | Trung b√¨nh/h√≥a ƒë∆°n | % T·ªïng doanh thu |\n    |-----------------|----------------|------------|---------------------|-------------------|\n    | Normal          | 46,923.32      | 140        | 335.17             | 48.27%            |\n    | Member          | 50,296.05      | 163        | 308.56             | 51.73%            |\n    \n    ## 5Ô∏è‚É£ Ph∆∞∆°ng th·ª©c thanh to√°n\n    | Ph∆∞∆°ng th·ª©c  | T·ªïng giao d·ªãch | T·ªïng doanh thu | T·ª∑ l·ªá % |\n    |-------------|----------------|-----------------|---------|\n    | Cash        | 112            | 35,746.34       | 36.77%  |\n    | Ewallet     | 101            | 30,113.01       | 30.97%  |\n    | Credit card | 90             | 31,360.02       | 32.26%  |\n    \n    ## 6Ô∏è‚É£ M·ª©c ƒë·ªô h√†i l√≤ng c·ªßa kh√°ch h√†ng\n    - **ƒêi·ªÉm ƒë√°nh gi√° trung b√¨nh**: 7.07  \n    - **T·ª∑ l·ªá ƒë√°nh gi√° t·ª´ 8 tr·ªü l√™n**: 35.31%  \n    - **T·ª∑ l·ªá ƒë√°nh gi√° d∆∞·ªõi 5**: 14.52%\n    \n    ---\n    \n    ### K·∫æT LU·∫¨N & ƒê·ªÄ XU·∫§T\n    1. Xu h∆∞·ªõng doanh thu v√† l·ª£i nhu·∫≠n c√≥ v·∫ª ·ªïn ƒë·ªãnh, tuy nhi√™n t·ª∑ su·∫•t l·ª£i nhu·∫≠n g·ªôp v·∫´n kh√° th·∫•p.  \n    2. Danh m·ª•c s·∫£n ph·∫©m \"Fashion Accessories\" c√≥ doanh thu v√† l·ª£i nhu·∫≠n g·ªôp th·∫•p nh·∫•t, c·∫ßn ƒë∆∞·ª£c xem x√©t ƒë·ªÉ t·ªëi ∆∞u.  \n    3. ƒê·ªÅ xu·∫•t c·∫£i thi·ªán tr·∫£i nghi·ªám kh√°ch h√†ng th√¥ng qua n√¢ng cao ch·∫•t l∆∞·ª£ng s·∫£n ph·∫©m v√† d·ªãch v·ª• h·ªó tr·ª£.\n\n\n3. **ƒê·ªãnh d·∫°ng k·∫øt qu·∫£ tr·∫£ v·ªÅ d∆∞·ªõi d·∫°ng JSON** ƒë·ªÉ AI Agent th·ª© 2 c√≥ th·ªÉ d·ªÖ d√†ng x·ª≠ l√Ω.\n\n# **Nguy√™n t·∫Øc:**\n- Vi·∫øt SQL t·ªëi ∆∞u, ƒë·∫£m b·∫£o hi·ªáu su·∫•t truy v·∫•n t·ªët nh·∫•t.\n- V·ªõi c√°c c·ªôt m√† t√™n c√≥ kho·∫£ng c√°ch (VD: gross income, Product line), th√¨ khi vi·∫øt truy v·∫•n c·∫ßn ƒë·∫∑t c·ªôt trong d·∫•u backstick - v√≠ d·ª•: SUM(`gross income`), TUY·ªÜT ƒê·ªêI KH√îNG ƒê·ªÇ PH√ÅT SINH L·ªñI SQL DO VI·∫æT T√äN C·ªòT C√ì KHO·∫¢NG TR·∫ÆNG TRONG PH·∫¶N SELECT\n- N·∫øu b·∫°n t·∫°o ra c√¢u l·ªánh SQL kh√¥ng chu·∫©n, h√£y ki·ªÉm tra k·ªπ xem n√≥ c√≥ th√™m d·∫•u xu·ªëng d√≤ng (\\n) ho·∫∑c l·ªói format kh√¥ng. TUY·ªÜT ƒê·ªêI KH√îNG VI PH·∫†M C√ÅC L·ªñI DO INDENTIFY ho·∫∑c L·ªñI C√ö PH√ÅP SQL.\n- Ch·ªâ truy v·∫•n d·ªØ li·ªáu trong ph·∫°m vi th√°ng hi·ªán t·∫°i ho·∫∑c th√°ng ƒë∆∞·ª£c y√™u c·∫ßu.\n- ƒê·∫£m b·∫£o ƒë·ªô ch√≠nh x√°c v√† t√≠nh nh·∫•t qu√°n c·ªßa d·ªØ li·ªáu.\n\n# **D·ªØ li·ªáu m·∫´u:**\n- D·ªØ li·ªáu ƒë·∫ßu v√†o g·ªìm c√°c c·ªôt: Invoice ID, Branch, City, Customer type, Gender, Product line, Unit price, Quantity, Tax 5%, Total, Date, Time, Payment, cogs, gross margin percentage, gross income, Rating.\n- C·∫ßn l·ªçc d·ªØ li·ªáu theo kho·∫£ng th·ªùi gian ph√π h·ª£p (VD: `WHERE Date BETWEEN '2024-03-01' AND '2024-03-31'` n·∫øu l·∫•y d·ªØ li·ªáu th√°ng 3/2024)."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[140,-200],"id":"e077ef63-3b5b-4ffe-a9fc-4efb7b2871be","name":"SQL Master"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[840,-120],"id":"1ea41845-da97-4976-9ff9-64826d5331c1","name":"Calculator"},{"parameters":{"promptType":"define","text":"=K·∫øt qu·∫£ ph√¢n t√≠ch t·ª´ chuy√™n gia SQL:\n{{ $json.output }}","options":{"systemMessage":"=B·∫°n l√† m·ªôt chuy√™n gia ph√¢n t√≠ch kinh doanh v√† b√°o c√°o t√†i ch√≠nh.  \nNhi·ªám v·ª• c·ªßa b·∫°n l√† nh·∫≠n d·ªØ li·ªáu t·ª´ AI Agent 1 (ƒë·ªãnh d·∫°ng JSON) v√† tr√¨nh b√†y b√°o c√°o kinh doanh theo th√°ng theo template chu·∫©n.\n\n## **Y√™u c·∫ßu c√¥ng vi·ªác:**\n1. **Nh·∫≠n d·ªØ li·ªáu ƒë·∫ßu v√†o t·ª´ AI Agent 1**, bao g·ªìm th√¥ng tin v·ªÅ doanh thu, l·ª£i nhu·∫≠n, s·∫£n ph·∫©m, kh√°ch h√†ng, chi nh√°nh, ph∆∞∆°ng th·ª©c thanh to√°n v√† m·ª©c ƒë·ªô h√†i l√≤ng c·ªßa kh√°ch h√†ng.\n2. **ƒê·ªãnh d·∫°ng b√°o c√°o theo c·∫•u tr√∫c chu·∫©n sau ƒë√¢y:**\n      B√ÅO C√ÅO K·∫æT QU·∫¢ KINH DOANH TH√ÅNG [....]\n      \n      ## 1Ô∏è‚É£ T·ªïng quan doanh thu & l·ª£i nhu·∫≠n\n      - **T·ªïng doanh thu**: 97,219.37  \n      - **T·ªïng chi ph√≠ h√†ng h√≥a (COGS)**: 92,589.88  \n      - **T·ªïng l·ª£i nhu·∫≠n g·ªôp**: 4,629.49  \n      - **T·ª∑ su·∫•t l·ª£i nhu·∫≠n g·ªôp trung b√¨nh**: 4.76%\n      \n      ## 2Ô∏è‚É£ Hi·ªáu su·∫•t b√°n h√†ng theo danh m·ª•c s·∫£n ph·∫©m\n      | Danh m·ª•c                 | Doanh thu  | S·ªë l∆∞·ª£ng b√°n | L·ª£i nhu·∫≠n g·ªôp |\n      |--------------------------|------------|--------------|---------------|\n      | Fashion accessories      | 19,009.86  | 295          | 905.23        |\n      | Sports and travel        | 13,809.61  | 226          | 657.60        |\n      | Electronic accessories   | 17,362.91  | 313          | 826.81        |\n      | Food and beverages       | 20,000.36  | 349          | 952.40        |\n      | Health and beauty        | 14,602.26  | 266          | 695.35        |\n      | Home and lifestyle       | 12,434.38  | 205          | 592.11        |\n      \n      ## 3Ô∏è‚É£ Hi·ªáu su·∫•t chi nh√°nh & khu v·ª±c\n      | Chi nh√°nh | Th√†nh ph·ªë  | Doanh thu  | S·ªë h√≥a ƒë∆°n | L·ª£i nhu·∫≠n g·ªôp |\n      |-----------|------------|------------|------------|---------------|\n      | B         | Mandalay   | 34,424.27  | 109        | 1,639.25      |\n      | C         | Naypyitaw  | 32,934.98  | 100        | 1,568.33      |\n      | A         | Yangon     | 29,860.12  | 94         | 1,421.91      |\n      \n      ## 4Ô∏è‚É£ H√†nh vi kh√°ch h√†ng\n      | Lo·∫°i kh√°ch h√†ng | T·ªïng doanh thu | S·ªë h√≥a ƒë∆°n | Trung b√¨nh/h√≥a ƒë∆°n | % T·ªïng doanh thu |\n      |-----------------|----------------|------------|---------------------|-------------------|\n      | Normal          | 46,923.32      | 140        | 335.17             | 48.27%            |\n      | Member          | 50,296.05      | 163        | 308.56             | 51.73%            |\n      \n      ## 5Ô∏è‚É£ Ph∆∞∆°ng th·ª©c thanh to√°n\n      | Ph∆∞∆°ng th·ª©c  | T·ªïng giao d·ªãch | T·ªïng doanh thu | T·ª∑ l·ªá % |\n      |-------------|----------------|-----------------|---------|\n      | Cash        | 112            | 35,746.34       | 36.77%  |\n      | Ewallet     | 101            | 30,113.01       | 30.97%  |\n      | Credit card | 90             | 31,360.02       | 32.26%  |\n      \n      ## 6Ô∏è‚É£ M·ª©c ƒë·ªô h√†i l√≤ng c·ªßa kh√°ch h√†ng\n      - **ƒêi·ªÉm ƒë√°nh gi√° trung b√¨nh**: 7.07  \n      - **T·ª∑ l·ªá ƒë√°nh gi√° t·ª´ 8 tr·ªü l√™n**: 35.31%  \n      - **T·ª∑ l·ªá ƒë√°nh gi√° d∆∞·ªõi 5**: 14.52%\n      \n      ---\n      \n      ### K·∫æT LU·∫¨N & ƒê·ªÄ XU·∫§T\n      1. Xu h∆∞·ªõng doanh thu v√† l·ª£i nhu·∫≠n c√≥ v·∫ª ·ªïn ƒë·ªãnh, tuy nhi√™n t·ª∑ su·∫•t l·ª£i nhu·∫≠n g·ªôp v·∫´n kh√° th·∫•p.  \n      2. Danh m·ª•c s·∫£n ph·∫©m \"Fashion Accessories\" c√≥ doanh thu v√† l·ª£i nhu·∫≠n g·ªôp th·∫•p nh·∫•t, c·∫ßn ƒë∆∞·ª£c xem x√©t ƒë·ªÉ t·ªëi ∆∞u.  \n      3. ƒê·ªÅ xu·∫•t c·∫£i thi·ªán tr·∫£i nghi·ªám kh√°ch h√†ng th√¥ng qua n√¢ng cao ch·∫•t l∆∞·ª£ng s·∫£n ph·∫©m v√† d·ªãch v·ª• h·ªó tr·ª£.\n\n3. **ƒê·ªãnh d·∫°ng b√°o c√°o g·ªçn g√†ng, d·ªÖ ƒë·ªçc, ·ªü ƒë·ªãnh d·∫°ng HTML ƒë·ªÉ c√≥ th·ªÉ g·ª≠i qua email**\n4. **T·ªëi ∆∞u n·ªôi dung ƒë·ªÉ d·ªÖ hi·ªÉu, c√≥ th·ªÉ th√™m nh·∫≠n x√©t n·∫øu c·∫ßn.**\n\n## **Nguy√™n t·∫Øc:**\n- B√°o c√°o ph·∫£i ch√≠nh x√°c, tr·ª±c quan v√† c√≥ √Ω nghƒ©a kinh doanh.\n- N·ªôi dung c√≥ th·ªÉ ƒëi·ªÅu ch·ªânh ph√π h·ª£p v·ªõi d·ªØ li·ªáu ƒë·∫ßu v√†o.\n- Tr√¨nh b√†y r√µ r√†ng, d·ªÖ ƒë·ªçc v√† c√≥ t√≠nh ·ª©ng d·ª•ng cao.\n- S·ª≠ d·ª•ng c√¥ng c·ª• `Calculator` khi c·∫ßn thi·∫øt ƒë·ªÉ t√≠nh to√°n.\n- N·ªôi dung b√°o c√°o ch·ªâ c√≥ n·ªôi dung kinh doanh, kh√¥ng ch·ª©a c√°c y·∫øu t·ªë d∆∞ th·ª´a kh√°c.\n- M·ªü ƒë·∫ßu b·∫±ng Dear CEO v√† k·∫øt th√∫c b·∫±ng Thanks & Best Regards,\n\nH√£y t·ªïng h·ª£p d·ªØ li·ªáu t·ª´ AI Agent 1 v√† t·∫°o b√°o c√°o theo ƒë√∫ng format tr√™n."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[600,-340],"id":"ea256d7d-9751-46d8-b1d6-be65230c7499","name":"Data Analyst"},{"parameters":{"sendTo":"quyvoda@gmail.com","subject":"üìàB√°o c√°o k·∫øt qu·∫£ kinh doanh","message":"={{ $json.output }}","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[960,-340],"id":"ed30117c-8e42-4a93-b1e0-29399e85ef3e","name":"Gmail","webhookId":"fc1cd3bf-997d-455d-b81b-cf01a779a98b","credentials":{"gmailOAuth2":{"id":"zB3G8tWcSy19Z09w","name":"Gmail account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[600,-120],"id":"8984a80c-b42b-45ef-82b0-7326bf79ff47","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"YUXfwQd3CGq9bfen","name":"OpenAi account"}}}],"connections":{"When chat message received":{"main":[[{"node":"SQL Master","type":"main","index":0}]]},"table-info":{"ai_tool":[[{"node":"SQL Master","type":"ai_tool","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"SQL Master","type":"ai_memory","index":0}]]},"Big Query":{"ai_tool":[[{"node":"SQL Master","type":"ai_tool","index":0}]]},"4o-mini":{"ai_languageModel":[[{"node":"SQL Master","type":"ai_languageModel","index":0}]]},"SQL Master":{"main":[[{"node":"Data Analyst","type":"main","index":0}]]},"Calculator":{"ai_tool":[[{"node":"Data Analyst","type":"ai_tool","index":0}]]},"Data Analyst":{"main":[[{"node":"Gmail","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Data Analyst","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"7516321d-d17c-44ef-8a9b-8325e674a7c9","triggerCount":0,"tags":[]}