{"createdAt":"2025-03-30T08:45:32.766Z","updatedAt":"2025-03-30T21:18:44.000Z","id":"AOninW3Fq6q5dklS","name":"Chat AI with Gsheet Memory","active":true,"nodes":[{"parameters":{"public":true,"initialMessages":"Dạ, chào anh chị SINIFOOD có thể giúp gì không ạ?","options":{"subtitle":"Bot có thể hỗ trợ khách hàng về thông tin sản phẩm, giá, chính sách giao hàng và nhiều hơn nữa!","title":"Chat với Bot AI SiniFood","customCss":":root {\n  /* Colors */\n  --chat--color-primary: #e74266;\n  --chat--color-primary-shade-50: #db4061;\n  --chat--color-primary-shade-100: #cf3c5c;\n  --chat--color-secondary: #20b69e;\n  --chat--color-secondary-shade-50: #1ca08a;\n  --chat--color-white: #ffffff;\n  --chat--color-light: #f2f4f8;\n  --chat--color-light-shade-50: #e6e9f1;\n  --chat--color-light-shade-100: #c2c5cc;\n  --chat--color-medium: #d2d4d9;\n  --chat--color-dark: #101330;\n  --chat--color-disabled: #777980;\n  --chat--color-typing: #404040;\n\n  /* Base Layout */\n  --chat--spacing: 1rem;\n  --chat--border-radius: 0.25rem;\n  --chat--transition-duration: 0.15s;\n  --chat--font-family: (\n    -apple-system,\n    BlinkMacSystemFont,\n    'Segoe UI',\n    Roboto,\n    Oxygen-Sans,\n    Ubuntu,\n    Cantarell,\n    'Helvetica Neue',\n    sans-serif\n  );\n\n  /* Window Dimensions */\n  --chat--window--width: 400px;\n  --chat--window--height: 600px;\n  --chat--window--bottom: var(--chat--spacing);\n  --chat--window--right: var(--chat--spacing);\n  --chat--window--z-index: 9999;\n  --chat--window--border: 1px solid var(--chat--color-light-shade-50);\n  --chat--window--border-radius: var(--chat--border-radius);\n  --chat--window--margin-bottom: var(--chat--spacing);\n\n  /* Header Styles */\n  --chat--header-height: auto;\n  --chat--header--padding: var(--chat--spacing);\n  --chat--header--background: var(--chat--color-dark);\n  --chat--header--color: var(--chat--color-light);\n  --chat--header--border-top: none;\n  --chat--header--border-bottom: none;\n  --chat--header--border-left: none;\n  --chat--header--border-right: none;\n  --chat--heading--font-size: 2em;\n  --chat--subtitle--font-size: inherit;\n  --chat--subtitle--line-height: 1.8;\n\n  /* Message Styles */\n  --chat--message--font-size: 1rem;\n  --chat--message--padding: var(--chat--spacing);\n  --chat--message--border-radius: var(--chat--border-radius);\n  --chat--message-line-height: 1.5;\n  --chat--message--margin-bottom: calc(var(--chat--spacing) * 1);\n  --chat--message--bot--background: var(--chat--color-white);\n  --chat--message--bot--color: var(--chat--color-dark);\n  --chat--message--bot--border: none;\n  --chat--message--user--background: var(--chat--color-secondary);\n  --chat--message--user--color: var(--chat--color-white);\n  --chat--message--user--border: none;\n  --chat--message--pre--background: rgba(0, 0, 0, 0.05);\n  --chat--messages-list--padding: var(--chat--spacing);\n\n  /* Toggle Button */\n  --chat--toggle--size: 64px;\n  --chat--toggle--width: var(--chat--toggle--size);\n  --chat--toggle--height: var(--chat--toggle--size);\n  --chat--toggle--border-radius: 50%;\n  --chat--toggle--background: var(--chat--color-primary);\n  --chat--toggle--hover--background: var(--chat--color-primary-shade-50);\n  --chat--toggle--active--background: var(--chat--color-primary-shade-100);\n  --chat--toggle--color: var(--chat--color-white);\n\n  /* Input Area */\n  --chat--textarea--height: 50px;\n  --chat--textarea--max-height: 30rem;\n  --chat--input--font-size: inherit;\n  --chat--input--border: 0;\n  --chat--input--border-radius: 0;\n  --chat--input--padding: 0.8rem;\n  --chat--input--background: var(--chat--color-white);\n  --chat--input--text-color: initial;\n  --chat--input--line-height: 1.5;\n  --chat--input--placeholder--font-size: var(--chat--input--font-size);\n  --chat--input--border-active: 0;\n  --chat--input--left--panel--width: 2rem;\n\n  /* Button Styles */\n  --chat--button--color: var(--chat--color-light);\n  --chat--button--background: var(--chat--color-primary);\n  --chat--button--padding: calc(var(--chat--spacing) * 1 / 2) var(--chat--spacing);\n  --chat--button--border-radius: var(--chat--border-radius);\n  --chat--button--hover--color: var(--chat--color-light);\n  --chat--button--hover--background: var(--chat--color-primary-shade-50);\n  --chat--close--button--color-hover: var(--chat--color-primary);\n\n  /* Send and File Buttons */\n  --chat--input--send--button--background: var(--chat--color-white);\n  --chat--input--send--button--color: var(--chat--color-light);\n  --chat--input--send--button--background-hover: var(--chat--color-primary-shade-50);\n  --chat--input--send--button--color-hover: var(--chat--color-secondary-shade-50);\n  --chat--input--file--button--background: var(--chat--color-white);\n  --chat--input--file--button--color: var(--chat--color-secondary);\n  --chat--input--file--button--background-hover: var(--chat--input--file--button--background);\n  --chat--input--file--button--color-hover: var(--chat--color-secondary-shade-50);\n  --chat--files-spacing: 0.25rem;\n\n  /* Body and Footer */\n  --chat--body--background: var(--chat--color-light);\n  --chat--footer--background: var(--chat--color-light);\n  --chat--footer--color: var(--chat--color-dark);\n}\n\n\n/* You can override any class styles, too. Right-click inspect in Chat UI to find class to override. */\n.chat-message {\n\tmax-width: 50%;\n}"}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-20,80],"id":"3bdd7fee-0ab9-4c2f-801d-ef09fce294cf","name":"When chat message received","webhookId":"a4f14b90-d111-46a0-bc4a-3dfb97ea7311"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[100,260],"id":"e566077d-4b18-443a-b33c-71fb70790b4b","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"AbppeeKoJlW8Ucbi","name":"OpenAi account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[260,300],"id":"9b434fe8-b34d-4492-8d07-f51d2d2acd9a","name":"Window Buffer Memory"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"1khI-WdzDf-8AuMAoFMusLiVhjyxKOYxkYHDi4Tn50xU","mode":"list","cachedResultName":"Memory AI Agent","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1khI-WdzDf-8AuMAoFMusLiVhjyxKOYxkYHDi4Tn50xU/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"data","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1khI-WdzDf-8AuMAoFMusLiVhjyxKOYxkYHDi4Tn50xU/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Users":"SINIFOOD","Memories":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Memories', `Một nội dung mới của người dùng cần lưu trong ký ức, hoặc chủ đề mà được người dùng hỏi liên tục trong 3 lần. Summary một cách ngắn gọn trong 1 câu`, 'string') }}","Created":"={{ $now.format('yyyy-MM-dd')}}"},"matchingColumns":[],"schema":[{"id":"Memories","displayName":"Memories","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Users","displayName":"Users","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Created","displayName":"Created","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheetsTool","typeVersion":4.5,"position":[440,300],"id":"8b308efa-2ca9-423d-9675-fdb02add2350","name":"Save Memory","credentials":{"googleSheetsOAuth2Api":{"id":"bNb2xTaWmXFq8Uj6","name":"Google Sheets account"}}},{"parameters":{"name":"Get_Memory","description":"Gọi tool này để tra cứu về lịch sử trò chuyện trước đây với người dùng, nhầm nâng cao chất lượng trò chuyện","workflowId":{"__rl":true,"value":"AOninW3Fq6q5dklS","mode":"list","cachedResultName":"Chat AI with Gsheet Memory"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2,"position":[560,280],"id":"0a5b2b25-67cc-4d7c-9310-195e5f5e4d3a","name":"Get Memory"},{"parameters":{"options":{"systemMessage":"=#Vai trò:\nBạn là một trợ lý AI hữu ích, chuyên cung cấp các thông tin cần thiết cho người dùng về sản phẩm\nBạn đang đối thoại với SiniFoods Chat AI\n\n#Công cụ:\n1. `Save Memory`: Sử dụng công cụ này để lưu những thông tin cần chú ý của người dùng (thói quen/sở thích/mindset/những điểm cá nhân hóa) vào google sheet khi cần thiết.\n2. `Get_Memory`: Luôn sử dụng công cụ này trước khi phản hồi, mục đích để lọc lại bộ nhớ về thói quen/lịch sử trò chuyện với người dùng trước đây, nhằm nâng cao chất lượng trò chuyện. Nếu trong Get_Memory không có thông tin thì trả lời không biết, sau đó kêu liên hệ shop để biết chi tiết\n\n#Hướng dẫn:\n- Đảm bảo trả lời thân thiện, chuyên nghiệp, xưng hô anh chị với người chat, trả lời dạ trước khi trả lời, gọi khách thay gì gọi bạn. Nếu khách xưng hô gì thì mình xưng hô lại ví dụ khách xưng anh/chị thì mình gọi họ anh/chị và xưng em, còn khách xưng cô/chú/bác thì mình gọi cô/chú/bác và xưng con.\n- Luôn gọi công cụ Get_Memory để trích dẫn lịch sử trò chuyện với người dùng, trước khi đưa ra câu trả lời\n- Thời gian hiện tại là: {{ $now }}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[200,80],"id":"97657625-e11a-477e-865f-e85526fcca83","name":"Trợ Lý AI"},{"parameters":{"content":"## Main Workflow","height":540,"width":1100},"type":"n8n-nodes-base.stickyNote","position":[-260,20],"typeVersion":1,"id":"cca60b2b-ece5-4aa0-9935-e4afe0450470","name":"Sticky Note"},{"parameters":{"inputSource":"passthrough"},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[0,680],"id":"03623730-92c5-49a5-9d42-5ca73b455264","name":"When Executed by Another Workflow"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"Memories"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[360,680],"id":"0b097cf4-fc3c-4809-ad97-289ed32d2d28","name":"Aggregate"},{"parameters":{"assignments":{"assignments":[{"id":"49cd97d3-eba7-4413-85a2-3797a87dbda2","name":"Memories","value":"={{ $json.Memories }}","type":"array"}]},"options":{"ignoreConversionErrors":true}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[520,680],"id":"287330ec-83db-4e1c-b321-5049033556a5","name":"Edit Fields"},{"parameters":{"documentId":{"__rl":true,"value":"1khI-WdzDf-8AuMAoFMusLiVhjyxKOYxkYHDi4Tn50xU","mode":"list","cachedResultName":"Memory AI Agent","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1khI-WdzDf-8AuMAoFMusLiVhjyxKOYxkYHDi4Tn50xU/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"data","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1khI-WdzDf-8AuMAoFMusLiVhjyxKOYxkYHDi4Tn50xU/edit#gid=0"},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[180,680],"id":"3bd70027-bacd-4a4a-9f91-8d2c02d2d149","name":"Get Memory1","credentials":{"googleSheetsOAuth2Api":{"id":"bNb2xTaWmXFq8Uj6","name":"Google Sheets account"}}},{"parameters":{"content":"## Long Memory","height":280,"width":900,"color":3},"type":"n8n-nodes-base.stickyNote","position":[-160,600],"typeVersion":1,"id":"5605b141-f58e-480b-a0e4-56d9e8ef9adf","name":"Sticky Note1"}],"connections":{"When chat message received":{"main":[[{"node":"Trợ Lý AI","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Trợ Lý AI","type":"ai_languageModel","index":0}]]},"Window Buffer Memory":{"ai_memory":[[{"node":"Trợ Lý AI","type":"ai_memory","index":0}]]},"Save Memory":{"ai_tool":[[{"node":"Trợ Lý AI","type":"ai_tool","index":0}]]},"Get Memory":{"ai_tool":[[{"node":"Trợ Lý AI","type":"ai_tool","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"Get Memory1","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Get Memory1":{"main":[[{"node":"Aggregate","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"b2dbe774-162d-434a-b264-6d459bd1bf9d","triggerCount":2,"tags":[{"createdAt":"2025-03-30T08:39:27.413Z","updatedAt":"2025-03-30T08:39:27.413Z","id":"gcCwv9j3n98cTb1F","name":"Long Memory Demo"}]}